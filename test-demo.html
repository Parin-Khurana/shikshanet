<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Assignment Demo</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; background: #f5f5f5; }
        .container { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .section { margin-bottom: 30px; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .section h3 { margin-top: 0; color: #333; }
        button { background: #007bff; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
        input, select { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ddd; border-radius: 4px; }
        .result { margin-top: 10px; padding: 10px; border-radius: 4px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Test Assignment Demo</h1>
        <p>This page demonstrates the automatic test assignment functionality.</p>

        <!-- Step 1: Create Test Student -->
        <div class="section">
            <h3>Step 1: Create Test Student</h3>
            <p>First, create a test student account to receive assignments.</p>
            <p><strong>Option 1:</strong> Use the dedicated registration page</p>
            <a href="/register_student" target="_blank" style="display: inline-block; background: #007bff; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; margin: 10px 0;">Go to Student Registration</a>
            
            <p><strong>Option 2:</strong> Quick create for testing</p>
            <input type="text" id="studentName" placeholder="Student Name" value="Test Student">
            <input type="text" id="studentPhone" placeholder="Phone Number" value="+919999999999">
            <input type="email" id="studentEmail" placeholder="Email" value="test@example.com">
            <input type="password" id="studentPassword" placeholder="Password" value="password123">
            <button onclick="createTestStudent()">Quick Create Test Student</button>
            <div id="studentResult"></div>
        </div>

        <!-- Step 2: Assign Test -->
        <div class="section">
            <h3>Step 2: Assign Test to Student</h3>
            <p>Assign a test to the student using their phone number.</p>
            <input type="text" id="testName" placeholder="Test Name" value="Mathematics Quiz">
            <select id="courseName">
                <option value="">Select a course</option>
                <option value="Mathematics" selected>Mathematics</option>
                <option value="Science">Science</option>
                <option value="English">English</option>
            </select>
            <input type="text" id="dueDate" placeholder="Due Date (optional - dd-mm-yyyy)" value="">
            <input type="text" id="fileUrl" placeholder="File URL" value="http://localhost:8000/uploads/sample-test.pdf">
            <input type="text" id="fileName" placeholder="File Name" value="sample-test.pdf">
            <input type="text" id="assignPhone" placeholder="Student Phone" value="+919971064494">
            <button onclick="assignTest()">Assign Test</button>
            <div id="assignResult"></div>
        </div>

        <!-- Step 3: Check Student Dashboard -->
        <div class="section">
            <h3>Step 3: Check Results</h3>
            <p>After assignment, the student should see the test on their dashboard.</p>
            <button onclick="checkStudentDashboard()">Check Student Dashboard</button>
            <div id="dashboardResult"></div>
        </div>
    </div>

    <script>
        async function createTestStudent() {
            const name = document.getElementById('studentName').value;
            const phone = document.getElementById('studentPhone').value;
            const email = document.getElementById('studentEmail').value;
            const password = document.getElementById('studentPassword').value;

            try {
                const response = await fetch('/create-test-student', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name, phone, email, password })
                });

                const result = await response.json();
                const resultDiv = document.getElementById('studentResult');
                
                if (result.success) {
                    resultDiv.innerHTML = `<div class="result success">‚úÖ ${result.message}</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="result error">‚ùå ${result.error}</div>`;
                }
            } catch (error) {
                document.getElementById('studentResult').innerHTML = `<div class="result error">‚ùå Error: ${error.message}</div>`;
            }
        }

        async function assignTest() {
            const testName = document.getElementById('testName').value.trim();
            const courseName = document.getElementById('courseName').value;
            const dueDate = document.getElementById('dueDate').value.trim();
            const fileUrl = document.getElementById('fileUrl').value.trim();
            const fileName = document.getElementById('fileName').value.trim();
            const studentPhone = document.getElementById('assignPhone').value.trim();

            // Debug: Log the values
            console.log('Form values:', { testName, courseName, dueDate, fileUrl, fileName, studentPhone });

            // Validate required fields
            if (!testName) {
                document.getElementById('assignResult').innerHTML = `<div class="result error">‚ùå Please enter a test name</div>`;
                return;
            }
            if (!courseName) {
                document.getElementById('assignResult').innerHTML = `<div class="result error">‚ùå Please select a course</div>`;
                return;
            }
            // Due date is now optional - use a default if not provided
            const finalDueDate = dueDate || 'No due date';
            if (!fileUrl) {
                document.getElementById('assignResult').innerHTML = `<div class="result error">‚ùå Please enter a file URL</div>`;
                return;
            }
            if (!studentPhone) {
                document.getElementById('assignResult').innerHTML = `<div class="result error">‚ùå Please enter a student phone number</div>`;
                return;
            }

            try {
                const response = await fetch('/assign-test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ testName, courseName, dueDate: finalDueDate, fileUrl, fileName, studentPhone })
                });

                const result = await response.json();
                const resultDiv = document.getElementById('assignResult');
                
                if (result.success) {
                    resultDiv.innerHTML = `<div class="result success">‚úÖ ${result.message}</div>`;
                } else {
                    resultDiv.innerHTML = `<div class="result error">‚ùå ${result.error}</div>`;
                }
            } catch (error) {
                document.getElementById('assignResult').innerHTML = `<div class="result error">‚ùå Error: ${error.message}</div>`;
            }
        }

        function checkStudentDashboard() {
            const resultDiv = document.getElementById('dashboardResult');
            resultDiv.innerHTML = `
                <div class="result success">
                    ‚úÖ <strong>Next Steps:</strong><br>
                    1. Go to <a href="/login_student" target="_blank">Student Login</a><br>
                    2. Login with phone: <strong>+919971064494</strong> and password: <strong>password123</strong><br>
                    3. Check the "Tests" tab to see the assigned test<br>
                    4. The test should appear with all details (name, due date, file link, etc.)
                </div>
            `;
        }
    </script>
</body>
</html>
